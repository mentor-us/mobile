name: Deploy to Google Play 

on:
    push:
        branches:
            - feature/MU-55-deloy-app-google
        paths:
            - src
            - .github/workflows/deloy-to-google.yml

    workflow_dispatch:

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: ./src
        steps:
            - name: Checkout
              uses: actions/checkout@v3

            - name: Set up Node 18
              uses: actions/setup-node@v3
              with:
                  node-version: 18
                  registry-url: "https://registry.yarnpkg.com"

            - name: Install dependencies
              run: yarn install
        
            - name: Setup Java 17
              uses: actions/setup-java@v3
              with:
                distribution: 'temurin'
                java-version: '17'
                cache: 'gradle'
                
            - name: Build and sign APK
              run: |
                  cp ./.env.prod ./.env
                  cd android
                  ./gradlew bundleRelease

            # - name: Upload APK to Google Play
            #   run: |
            #       fastlane supply --track production --json_key ${{ secrets.GOOGLE_PLAY_JSON_KEY }} --package_name com.example.myapp --apk app-release.aab --skip_upload_metadata --skip_upload_images --skip_upload_screenshots
